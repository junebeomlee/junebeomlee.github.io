<div id="root" style="display: flex; align-items: center; justify-content: center; width: 100vw; height: 100vh;"></div>
<script>
    const rootElement = document.getElementById("root");

    const todoData = [
        {
            id: 1,
            title: "TIL 작성하기"
        },
        {
            id: 2,
            title: "코딩 테스트 문제 5개 풀어보기"
        },
        {
            id: 3,
            title: "프로그래밍 공부 & 기록 정리"
        }
    ]

    const dispatcher = "";


    function useState(initialValue = null) {
        let state = initialValue;
        const getState = () => state;

        // 함수인지 체크 해서 prev 적용
        const setState = (newValue) => {
            state = newValue;
            render(App, rootElement);
        }
        
        return [getState, setState];
    }

    function render(reactElement, htmlElement) {
        // DIFF 알고리즘 적용이 필요하므로 일단 전부 리렌더링
        htmlElement.innerHTML = "";
        htmlElement.append(reactElement());   
    }


    function createElement(tagName, attributes = {}, children = null) {
        const element = document.createElement(tagName);
        // attribute 적용
        if(attributes?.style) {
            const {style} = attributes;

            for(let attr in style) {
                element.style[attr] = style[attr];
            }
        }

        // 이벤트 리스너 추가
        if(attributes?.onClick) {
            element.onclick = attributes.onClick;
            // element.addEventListener("click", attributes.onClick);
        }

        // children이 배열인 경우,
        if(Array.isArray(children)) {
            children.forEach(child => {
                // children 추가 로직 중복
                if(typeof child === "string") {
                    element.appendChild(document.createTextNode(child));
                } else {
                    element.append(child);
                }
            });
        }
        else if(children) {
            if(typeof children === "string") {
                element.appendChild(document.createTextNode(children));
            } else {
                element.append(children);
            }
        }

        return element;
    }

    function App() {
        console.log("rerender");
        
        const [todos, setTodos] = useState(todoData);
        const handleDeleteTodo = (selectedTodo) => {
            const changedTodo = todos().find(todo => selectedTodo);

            if(changedTodo) {
                const changedTodos = [...todos().filter(todo => todo != changedTodo)];
                setTodos(changedTodos);
            }
        }

        return createElement("div", {style: {display: "flex", flexDirection: "column", gap: "8px", minWidth: "280px"}}, [
            createElement("div", {}, "TODO"),
            ...todoData.map(todo => Todo({todo, onDeleteTodo: handleDeleteTodo})),
            createElement("button", {style: {padding: "4px"}}, "추가하기")
        ]
        );
    }

    function Todo({todo, onDeleteTodo}) {
        const {id, title} = todo;
        return createElement("div", {style: {display: "flex", flexDirection: "row", justifyContent: "space-between", border: "1px solid", padding: "10px"}}, [
            createElement("div", {}, title),
            createElement("button", {onClick: () => onDeleteTodo(todo)}, "X"),
        ]);
    }

    // start;
    render(App, rootElement);
</script>